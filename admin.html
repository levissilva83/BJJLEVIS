<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Academy Jiu Jitsu</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header admin">
    <h1>üîê Painel Administrativo</h1>
    <p>Academy Jiu Jitsu by Professor Levi Silva</p>
  </header>

  <div class="container">
    <div id="mensagem" class="mensagem"></div>

    <div class="tabs">
      <button class="tab-btn active" onclick="abrirTabAdmin('pendentes')">Pendentes</button>
      <button class="tab-btn" onclick="abrirTabAdmin('alunos')">Alunos</button>
      <button class="tab-btn" onclick="abrirTabAdmin('cts')">CTs</button>
    </div>

    <!-- ABA PENDENTES -->
    <div id="pendentes" class="tab-content active">
      <div class="card admin">
        <h2>‚è≥ Alunos Pendentes de Aprova√ß√£o</h2>
        <div id="tabelaPendentes">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Faixa</th>
                <th>A√ß√£o</th>
              </tr>
            </thead>
            <tbody id="corpoPendentes">
              <tr><td colspan="4" style="text-align:center; padding:20px;">Carregando...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ABA ALUNOS -->
    <div id="alunos" class="tab-content">
      <div class="card admin">
        <h2>üë• Todos os Alunos</h2>
        <div id="tabelaAlunos">
          <table>
            <thead>
              <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Faixa</th>
                <th>Status</th>
                <th>Grau</th>
              </tr>
            </thead>
            <tbody id="corpoAlunos">
              <tr><td colspan="5" style="text-align:center; padding:20px;">Carregando...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ABA CTS -->
    <div id="cts" class="tab-content">
      <div class="card admin">
        <h2>üè¢ Centros de Treinamento</h2>

        <h3 style="margin-top:20px; margin-bottom:15px;">Cadastrar Novo CT</h3>
        <div class="form-group">
          <label>Nome:</label>
          <input type="text" id="ctNome" placeholder="Nome do CT">
        </div>
        <div class="form-group">
          <label>Cidade:</label>
          <input type="text" id="ctCidade" placeholder="Cidade">
        </div>
        <div class="form-group">
          <label>Estado:</label>
          <input type="text" id="ctEstado" placeholder="Estado">
        </div>
        <div class="form-group">
          <label>Respons√°vel:</label>
          <input type="text" id="ctResponsavel" placeholder="Nome do respons√°vel">
        </div>
        <button class="button green" onclick="cadastrarCT()">Cadastrar CT</button>

        <h3 style="margin-top:30px; margin-bottom:15px;">CTs Cadastrados</h3>
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cidade</th>
              <th>Estado</th>
              <th>Respons√°vel</th>
            </tr>
          </thead>
          <tbody id="corpoCTs">
            <tr><td colspan="4" style="text-align:center; padding:20px;">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <button class="button-logout admin" onclick="sairAdmin()">Sair do Admin</button>
  </div>

  <script src="app.js"></script>
  <script>
    if (!localStorage.getItem('adminMode')) {
      window.location.href = 'index.html';
    }

    function abrirTabAdmin(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');
      
      if (tab === 'alunos') carregarAlunos();
      if (tab === 'cts') carregarCTs();
    }

    function carregarPendentes() {
      chamarAPI('obterPendentes', {}, function(resultado) {
        const tbody = document.getElementById('corpoPendentes');
        tbody.innerHTML = '';
        
        if (resultado.dados && resultado.dados.length > 0) {
          resultado.dados.forEach(aluno => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${aluno.Nome}</td>
              <td>${aluno.Email}</td>
              <td>${aluno.Faixa}</td>
              <td><button class="button green" onclick="aprovarAluno('${aluno.ID}')">Aprovar</button></td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">Nenhum aluno pendente</td></tr>';
        }
      });
    }

    function carregarAlunos() {
      chamarAPI('obterTodosAlunos', {}, function(resultado) {
        const tbody = document.getElementById('corpoAlunos');
        tbody.innerHTML = '';
        
        if (resultado.dados && resultado.dados.length > 0) {
          resultado.dados.forEach(aluno => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${aluno.Nome}</td>
              <td>${aluno.Email}</td>
              <td>${aluno.Faixa}</td>
              <td>${aluno.Status}</td>
              <td>${aluno.Grau}</td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:20px;">Nenhum aluno</td></tr>';
        }
      });
    }

    function carregarCTs() {
      chamarAPI('obterTodosCTs', {}, function(resultado) {
        const tbody = document.getElementById('corpoCTs');
        tbody.innerHTML = '';
        
        if (resultado.dados && resultado.dados.length > 0) {
          resultado.dados.forEach(ct => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${ct.Nome}</td>
              <td>${ct.Cidade}</td>
              <td>${ct.Estado}</td>
              <td>${ct.Responsavel}</td>
            `;
            tbody.appendChild(tr);
          });
        } else {
          tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:20px;">Nenhum CT</td></tr>';
        }
      });
    }

    function aprovarAluno(alunoID) {
      chamarAPI('aprovarAluno', { alunoID }, function(resultado) {
        if (resultado.sucesso) {
          mostrarMensagem('Aluno aprovado!', 'success');
          carregarPendentes();
        } else {
          mostrarMensagem(resultado.mensagem, 'error');
        }
      });
    }

    function cadastrarCT() {
      const nome = document.getElementById('ctNome').value;
      const cidade = document.getElementById('ctCidade').value;
      const estado = document.getElementById('ctEstado').value;
      const responsavel = document.getElementById('ctResponsavel').value;
      
      if (!nome || !cidade || !estado || !responsavel) {
        mostrarMensagem('Preencha todos os campos', 'error');
        return;
      }
      
      chamarAPI('cadastrarCT', { nome, cidade, estado, responsavel }, function(resultado) {
        if (resultado.sucesso) {
          mostrarMensagem('CT cadastrado!', 'success');
          document.getElementById('ctNome').value = '';
          document.getElementById('ctCidade').value = '';
          document.getElementById('ctEstado').value = '';
          document.getElementById('ctResponsavel').value = '';
          carregarCTs();
        } else {
          mostrarMensagem(resultado.mensagem, 'error');
        }
      });
    }

    function sairAdmin() {
      localStorage.removeItem('adminMode');
      window.location.href = 'index.html';
    }

    function mostrarMensagem(txt, tipo) {
      const el = document.getElementById('mensagem');
      el.className = 'mensagem ' + tipo;
      el.textContent = txt;
      setTimeout(() => {
        el.className = 'mensagem';
        el.textContent = '';
      }, 3000);
    }

    carregarPendentes();
  </script>
</body>
</html>
